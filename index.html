<!DOCTYPE html>
<html>

<head>
    <title>QR Code Generator</title>
    <link href="lib/tailwind.min.css" rel="stylesheet" type="text/css" />
    <style>
        html,
        body,
        #app {
            height: 100vh;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }

        svg {
            width: 256px;
            height: 256px;
        }

        .mwh {
            min-width: 380px;
            min-height: 290px;
        }

        a {
            color: rgb(34, 125, 230);
        }
        a:hover {
            color: rgb(0, 105, 224);
        }
        #unitID * {
            background-color: rgba(31,41,55,var(--tw-bg-opacity)) ;
        }
    </style>
</head>

<body>
    <div class="w-full h-full bg-gray-800 absolute flex flex-row justify-center items-center">
        <div class="bg-gray-300 m-auto shadow-lg p-5 rounded w-1/4 h-auto mwh">
            <div class="flex flex-col justify-start w-full h-full items-center">
                <div class="flex flex-row items-center h-14 pl-1 rounded border-gray-900 bg-gray-800 border-1 text-white mb-2 w-full max-w-full">
                    <select class="h-full pr-4 pl-1 bg-transparent text-white bg-grey-800 w-full"
                     id="unitID" name="unitID"> 
	  	      <option value="1" style="display:none">Select Unit</option>
                      <option value="4">Council</option>
                      <option value="5">Pack 0001</option>
                      <option value="6">Pack 0003</option>
                      <option value="7">Pack 0007</option>
<option value="8">Pack 0008</option>
<option value="9">Pack 0009</option>
<option value="10">Pack 0010</option>
<option value="11">Pack 0011</option>
<option value="12">Pack 0013</option>
<option value="13">Pack 0015</option>
<option value="14">Pack 0019</option>
<option value="15">Pack 0025</option>
<option value="16">Pack 0033</option>
<option value="17">Pack 0034</option>
<option value="18">Pack 0042</option>
<option value="19">Pack 0046</option>
<option value="20">Pack 0049</option>
<option value="21">Pack 0051</option>
<option value="22">Pack 0055</option>
<option value="23">Pack 0058</option>
<option value="24">Pack 0063</option>
<option value="25">Pack 0065</option>
<option value="26">Pack 0067</option>
<option value="27">Pack 0070</option>
<option value="28">Pack 0072</option>
<option value="29">Pack 0079</option>
<option value="30">Pack 0097</option>
<option value="31">Pack 0107</option>
<option value="32">Pack 0116</option>
<option value="33">Pack 0118</option>
<option value="34">Pack 0119</option>
<option value="35">Pack 0140</option>
<option value="36">Pack 0144</option>
<option value="37">Pack 0148</option>
<option value="38">Pack 0152</option>
<option value="39">Pack 0164</option>
<option value="40">Pack 0167</option>
<option value="41">Pack 0174</option>
<option value="42">Pack 0186</option>
<option value="43">Pack 0200</option>
<option value="44">Pack 0214</option>
<option value="45">Pack 0222</option>
<option value="46">Pack 0249</option>
<option value="47">Pack 0256</option>
<option value="48">Pack 0265</option>
<option value="49">Pack 0321</option>
<option value="50">Pack 0323</option>
<option value="51">Pack 0405</option>
<option value="52">Pack 0490</option>
<option value="53">Pack 0502</option>
<option value="54">Pack 0613</option>
<option value="55">Pack 0865</option>
<option value="56">Pack 1825</option>
<option value="57">Pack 1906</option>
<option value="58">Pack 1911</option>
<option value="59">Pack 2287</option>
<option value="60">Pack 4005</option>
<option value="61">Troop 0001</option>
<option value="62">Troop 0003</option>
<option value="63">Troop 0003G</option>
<option value="64">Troop 0007</option>
<option value="65">Troop 0008</option>
<option value="66">Troop 0009</option>
<option value="67">Troop 0010</option>
<option value="68">Troop 0011</option>
<option value="69">Troop 0013</option>
<option value="70">Troop 0015</option>
<option value="71">Troop 0019</option>
<option value="72">Troop 0019G</option>
<option value="73">Troop 0024</option>
<option value="74">Troop 0024G</option>
<option value="75">Troop 0025</option>
<option value="76">Troop 0033</option>
<option value="77">Troop 0034</option>
<option value="78">Troop 0039</option>
<option value="79">Troop 0042</option>
<option value="80">Troop 0045</option>
<option value="81">Troop 0046</option>
<option value="82">Troop 0049</option>
<option value="83">Troop 0051</option>
<option value="84">Troop 0055</option>
<option value="85">Troop 0058</option>
<option value="86">Troop 0058G</option>
<option value="87">Troop 0063</option>
<option value="88">Troop 0065</option>
<option value="89">Troop 0067</option>
<option value="90">Troop 0070</option>
<option value="91">Troop 0070G</option>
<option value="92">Troop 0072</option>
<option value="93">Troop 0079</option>
<option value="94">Troop 0087</option>
<option value="95">Troop 0097</option>
<option value="96">Troop 0099</option>
<option value="97">Troop 0107</option>
<option value="98">Troop 0111G</option>
<option value="99">Troop 0114</option>
<option value="100">Troop 0116</option>
<option value="101">Troop 0118</option>
<option value="102">Troop 0119</option>
<option value="103">Troop 0133</option>
<option value="104">Troop 0139</option>
<option value="105">Troop 0140</option>
                      <option value="106">Troop 0144</option>
                      <option value="107">Troop 0146</option>
                      <option value="108">Troop 0148</option>
                      <option value="109">Troop 0164</option>
                      <option value="110">Troop 0165</option>
                      <option value="111">Troop 0167</option>
                      <option value="112">Troop 0167G</option>
                      <option value="113">Troop 0174</option>
                      <option value="114">Troop 0186</option>
                      <option value="115">Troop 0200</option>
                      <option value="116">Troop 0219</option>
                      <option value="117">Troop 0222</option>
                      <option value="118">Troop 0222G</option>
                      <option value="119">Troop 0233</option>
                      <option value="120">Troop 0248</option>
                      <option value="121">Troop 0249</option>
                      <option value="122">Troop 0249G</option>
                      <option value="123">Troop 0256</option>
                      <option value="124">Troop 0256G</option>
                      <option value="125">Troop 0288</option>
                      <option value="126">Troop 0321</option>
                      <option value="127">Troop 0321G</option>
                      <option value="128">Troop 0323</option>
                      <option value="129">Troop 0355</option>
                      <option value="130">Troop 0405</option>
                      <option value="131">Troop 0405G</option>
                      <option value="132">Troop 0490</option>
                      <option value="133">Troop 0502G</option>
                      <option value="134">Troop 0502</option>
                      <option value="135">Troop 1906</option>
                      <option value="136">Troop 2287</option>
                      <option value="137">Crew 0011</option>
                      <option value="138">Crew 0019</option>
                      <option value="139">Crew 0058</option>
                      <option value="140">Crew 0167</option>
                      <option value="141">Crew 0321</option>
                      <option value="142">Crew 1465</option>
                      <option value="143">Ship 0019</option>
                    </select>
                <!--
               </div>
                -->
                    <input type="text" placeholder="First Name"
                        class="h-full pl-1 text-current bg-transparent focus:outline-none w-full" id="firstName"
                        value="">
                    <input type="text" placeholder="Last Name"
                        class="h-full pl-1 text-current bg-transparent focus:outline-none w-full" id="lastName"
                        value="">

                    <button class="h-full pl-2 text-right pr-2 border-l-gray-900 border-l-1 hover:bg-gray-700 rounded-r-md"
                        id="genLinkBtn">Generate</button>
                </div>
                <div id="qrcode" class="m-2"></div>
                <!-- download links -->
                <div>
                    <a href="#" id="dlpng" class="mr-2 text-blue">PNG</a>

                    <select id="imgSize" name="imgSize" class="mt-2 rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6 inline">
                        <option value="256" selected>256px</option>
                        <option value="512">512px</option>
                        <option value="1024">1024px</option>
                        <option value="2048">2048px</option>
                      </select>

                    <a href="#" id="dlsvg" class="ml-2">SVG</a>
                </div>

                <canvas id="canv" style="display: none" width="512" height="512" />
            </div>
        </div>
    </div>

    <script src="lib/qrcode.min.js"></script>
    <script type="module">
        import { Canvg } from 'https://cdn.skypack.dev/canvg@^4.0.0'
        let lastQuery = 'https://www.mccscouting.org/campcard'

        const size = document.getElementById('imgSize')

        function genSvg(val) {
            return new QRCode({
                content: val,
                container: 'svg-viewbox',
                join: true,
                width: size.value,
                height: size.value
            }).svg()
        }

        function genPng(val) {
            const canvas = document.getElementById('canv')
            canvas.width = size.value
            canvas.height = size.value

            const ctx = canvas.getContext('2d')
            const svg = genSvg(val)

            const rend = Canvg.fromString(ctx, svg)
            rend.start()

            return canvas.toDataURL('img/png')
        }

        // Wifi QR Code
        // Format: WIFI:S:SSID_NAME;H:true;T:WPA2;P:PASSWORD;;

        window.onload = () => {
            // Check query params
            const params = new Proxy(new URLSearchParams(window.location.search), {
                get: (searchParams, prop) => searchParams.get(prop),
            });
            
            let qr = document.getElementById("qrcode");

            let genLinkBtn = document.getElementById("genLinkBtn")
            let firstName = document.getElementById("firstName")
            let lastName = document.getElementById("lastName")
            let unitID = document.getElementById("unitID")

            // Wifi QR
            genLinkBtn.onclick = () => {
                const firstN = firstName.value
                const lastN = lastName.value
                const unit = unitID.value;
                const fullURL = `https://www.mccscouting.org/campcard?element_7_1=${firstN}&element_7_2=${lastN}&element_12=${unit}`
                qr.innerHTML = genSvg(fullURL)
                lastQuery = fullURL
            }

            const qlink = params.link
            if(qlink && qlink.trim() !== '') {
                link.value = qlink

                qr.innerHTML = genSvg(qlink)
                lastQuery = qlink
            }
            else
                qr.innerHTML = genSvg('https://google.com')
            
            // Download
            var dlPng = document.getElementById('dlpng')
            var dlSvg = document.getElementById('dlsvg')

            dlPng.onclick = () => {
                var link = document.createElement('a')

                link.download = `${encodeURI(lastQuery)}.png`
                link.href = genPng(lastQuery)

                link.click()
            }

            dlSvg.onclick = () => {
                const svgBlob = new Blob([genSvg(lastQuery)], {type:"image/svg+xml;charset=utf-8"})
                const svgUrl = URL.createObjectURL(svgBlob)

                let link = document.createElement('a')
                link.download = `${encodeURI(lastQuery)}.svg`
                link.href = svgUrl

                link.click()
            }
        }
    </script>
</body>

</html>
